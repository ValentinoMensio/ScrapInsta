<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ScrapInsta</title>
  <style>
    :root{
      --bg: #0b1020;
      --panel: rgba(255,255,255,0.08);
      --panel2: rgba(255,255,255,0.06);
      --border: rgba(255,255,255,0.10);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.62);
      --muted2: rgba(255,255,255,0.48);

      --primary: #7c3aed;       /* violeta */
      --primary2: #ec4899;      /* rosa */
      --success: #22c55e;
      --danger:  #ef4444;
      --warn:    #f59e0b;

      --shadow: 0 14px 38px rgba(0,0,0,0.45);
      --radius: 16px;
      --radius2: 12px;
      --ring: 0 0 0 3px rgba(236,72,153,0.18);
    }

    html, body {
      margin: 0;
      padding: 0;
      width: 360px;
      height: 600px;
      overflow: hidden;
      background: var(--bg);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Arial;
    }

    /* Fondo pro (oscuro + aurora) */
    body::before{
      content:"";
      position: fixed;
      inset: 0;
      background:
        radial-gradient(700px 400px at 15% 10%, rgba(124,58,237,0.35), transparent 60%),
        radial-gradient(700px 500px at 85% 20%, rgba(236,72,153,0.25), transparent 55%),
        radial-gradient(800px 600px at 50% 95%, rgba(34,197,94,0.10), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.04), transparent 35%);
      pointer-events: none;
      filter: saturate(1.05);
    }

    .app {
      position: relative;
      height: 600px;
      padding: 12px;
      box-sizing: border-box;
    }

    .panel {
      height: 100%;
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06));
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    .header{
      padding: 12px 14px 10px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .brand{
      display: flex;
      flex-direction: column;
      line-height: 1.1;
    }
    .brand .title{
      font-size: 14px;
      font-weight: 800;
      letter-spacing: 0.2px;
      background: linear-gradient(90deg, var(--primary), var(--primary2));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    .brand .subtitle{
      font-size: 11px;
      color: var(--muted);
      margin-top: 3px;
    }

    .status-pill{
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.20);
      color: var(--muted);
      font-size: 11px;
      white-space: nowrap;
      cursor: pointer;
      transition: background 0.2s, border-color 0.2s;
    }
    .status-pill:hover{
      background: rgba(255,255,255,0.08);
      border-color: rgba(255,255,255,0.18);
    }
    .dot{
      width: 8px; height: 8px;
      border-radius: 50%;
      background: rgba(255,255,255,0.35);
      box-shadow: 0 0 0 3px rgba(255,255,255,0.08);
    }
    .dot.ok{ background: var(--success); box-shadow: 0 0 0 3px rgba(34,197,94,0.18); }
    .dot.err{ background: var(--danger); box-shadow: 0 0 0 3px rgba(239,68,68,0.18); }

    /* Tabs */
    .tabs{
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      padding: 10px 14px;
    }
    .tab{
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.22);
      color: rgba(255,255,255,0.80);
      padding: 10px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: transform 0.08s, background 0.2s, border-color 0.2s;
      user-select: none;
    }
    .tab:hover{ background: rgba(0,0,0,0.30); }
    .tab:active{ transform: translateY(0.5px); }
    .tab.active{
      background: linear-gradient(90deg, rgba(124,58,237,0.35), rgba(236,72,153,0.30));
      border-color: rgba(236,72,153,0.35);
      box-shadow: 0 6px 18px rgba(0,0,0,0.25);
      color: rgba(255,255,255,0.95);
    }

    /* Content */
    .content{
      padding: 10px 14px 12px;
      overflow: auto;
      -webkit-overflow-scrolling: touch;
      flex: 1;
    }

    .section{
      background: rgba(0,0,0,0.20);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: var(--radius);
      padding: 12px;
      margin-bottom: 10px;
    }
    .section-title{
      font-size: 12px;
      font-weight: 800;
      margin: 0 0 10px;
      color: rgba(255,255,255,0.90);
      letter-spacing: 0.2px;
    }
    .hint{
      font-size: 11px;
      color: var(--muted);
      margin: 6px 0 0;
      line-height: 1.3;
    }

    label{
      display: block;
      font-size: 11px;
      color: var(--muted);
      font-weight: 700;
      margin: 10px 0 6px;
    }
    input, select, textarea, button{
      width: 100%;
      box-sizing: border-box;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(20,20,30,0.95);
      color: rgba(255,255,255,0.92);
      padding: 10px 10px;
      font-size: 12px;
      outline: none;
    }
    select{
      background: rgba(20,20,30,0.98);
      color: #fff;
    }
    select option{
      background: #1a1a2e;
      color: #fff;
      padding: 8px;
    }
    textarea{ resize: vertical; min-height: 92px; }
    input::placeholder, textarea::placeholder{ color: rgba(255,255,255,0.35); }

    input:focus, select:focus, textarea:focus{
      border-color: rgba(236,72,153,0.50);
      box-shadow: var(--ring);
    }

    .row{
      display: grid;
      grid-template-columns: 1fr 120px;
      gap: 8px;
      align-items: end;
    }

    .btn{
      cursor: pointer;
      border: none;
      font-weight: 800;
      transition: transform 0.08s, filter 0.2s, opacity 0.2s;
    }
    .btn:active{ transform: translateY(0.5px); }
    .btn.primary{
      background: linear-gradient(90deg, rgba(124,58,237,0.95), rgba(236,72,153,0.95));
      color: white;
    }
    .btn.secondary{
      background: rgba(255,255,255,0.10);
      color: rgba(255,255,255,0.92);
      border: 1px solid rgba(255,255,255,0.12);
    }
    .btn.success{ background: rgba(34,197,94,0.92); color: #06120a; }
    .btn.danger{ background: rgba(239,68,68,0.92); color: #1b0707; }
    .btn:disabled{ opacity: 0.45; cursor: not-allowed; }

    .divider{
      height: 1px;
      background: rgba(255,255,255,0.08);
      margin: 12px 0;
    }

    /* Badges + progress */
    .badges{
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .badge{
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.82);
    }
    .badge .mini-dot{
      width: 8px; height: 8px; border-radius: 50%;
      background: rgba(255,255,255,0.35);
    }
    .badge.ok .mini-dot{ background: var(--success); }
    .badge.err .mini-dot{ background: var(--danger); }
    .badge.queued .mini-dot{ background: var(--warn); }
    .badge.sent .mini-dot{ background: rgba(59,130,246,0.95); }

    .progress{
      margin-top: 10px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 999px;
      overflow: hidden;
      height: 8px;
    }
    .progress > div{
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--primary), var(--primary2));
      transition: width 0.25s;
    }
    .progress-text{
      margin-top: 8px;
      font-size: 11px;
      color: var(--muted);
    }

    /* Footer note */
    .footer-note{
      padding: 10px 14px 12px;
      border-top: 1px solid rgba(255,255,255,0.08);
      font-size: 11px;
      color: var(--muted2);
      background: rgba(0,0,0,0.18);
    }

    /* Show/hide tabs */
    .tab-content{ display: none; }
    .tab-content.active{ display: block; }

    /* Checkbox */
    .check{
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.05);
      margin-top: 10px;
      color: rgba(255,255,255,0.85);
      font-size: 12px;
    }
    .check input{ width: auto; }

    /* Small status line */
    .status-line{
      margin-top: 10px;
      font-size: 11px;
      color: var(--muted);
    }
    .status-line.ok{ color: rgba(34,197,94,0.95); }
    .status-line.err{ color: rgba(239,68,68,0.95); }

    /* Setup screen */
    .setup-screen{
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 40px 24px;
      flex: 1;
    }
    .setup-screen .icon{
      font-size: 48px;
      margin-bottom: 16px;
    }
    .setup-screen h2{
      font-size: 18px;
      font-weight: 800;
      margin: 0 0 8px;
      color: rgba(255,255,255,0.92);
    }
    .setup-screen p{
      font-size: 13px;
      color: var(--muted);
      margin: 0 0 20px;
      line-height: 1.5;
    }
    .setup-screen .btn{
      padding: 12px 32px;
      font-size: 14px;
    }
    .setup-screen .checklist{
      text-align: left;
      margin: 16px 0 20px;
      padding: 12px 16px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 12px;
      font-size: 12px;
      color: var(--muted);
    }
    .setup-screen .checklist-item{
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 0;
    }
    .setup-screen .checklist-item.ok{ color: var(--success); }
    .setup-screen .checklist-item.missing{ color: var(--danger); }
  </style>
</head>

<body>
  <div class="app">
    <div class="panel">
      <!-- Header -->
      <div class="header">
        <div class="brand">
          <div class="title">ScrapInsta</div>
          <div class="subtitle" id="env">API: — | Cuenta: —</div>
        </div>

        <div class="status-pill" id="apiStatus">
          <span class="dot" id="apiDot"></span>
          <span id="apiText">Sin conectar</span>
        </div>
      </div>

      <!-- Setup Screen (shown if config missing) -->
      <div id="setup-screen" class="setup-screen" style="display:none;">
        <div class="icon">⚙️</div>
        <h2>Configuración necesaria</h2>
        <p>Para usar ScrapInsta necesitás configurar tu conexión a la API.</p>
        <div class="checklist" id="setup-checklist">
          <div class="checklist-item" id="check-api">
            <span class="check-icon">○</span>
            <span>URL de la API</span>
          </div>
          <div class="checklist-item" id="check-token">
            <span class="check-icon">○</span>
            <span>Token / API Key</span>
          </div>
          <div class="checklist-item" id="check-account">
            <span class="check-icon">○</span>
            <span>Cuenta Instagram (X-Account)</span>
          </div>
        </div>
        <button class="btn primary" id="btn-open-options">Configurar</button>
      </div>

      <!-- Main UI (shown when config OK) -->
      <div id="main-ui" style="display:flex; flex-direction:column; flex:1; overflow:hidden;">
        <!-- Tabs -->
        <div class="tabs">
          <div class="tab active" data-tab="fetch">Extraer</div>
          <div class="tab" data-tab="send">Enviar DMs</div>
        </div>

        <!-- Content -->
        <div class="content">

        <!-- TAB: EXTRAER -->
        <div id="tab-fetch" class="tab-content active">
          <div class="section">
            <p class="section-title">Extracción</p>

            <label for="mode">¿Qué querés extraer?</label>
            <select id="mode">
              <option value="followings">Followings de una cuenta</option>
              <option value="analyze">Analizar perfiles específicos</option>
            </select>

            <div id="followings_fields">
              <label for="target">Target username</label>
              <input id="target" placeholder="usuario objetivo" autocomplete="off" />

              <label for="limit">Límite</label>
              <div class="row">
                <input id="limit" type="number" min="1" step="1" value="50" />
                <button id="enqueue" class="btn primary">Encolar</button>
              </div>
            </div>

            <div id="analyze_fields" style="display:none;">
              <label for="usernames">Usernames (uno por línea o coma)</label>
              <textarea id="usernames" rows="4" placeholder="user1&#10;user2, user3"></textarea>
              <input id="batch_size" type="hidden" value="25" />
              <button id="enqueue_analyze" class="btn primary" style="margin-top:10px;">Analizar perfiles</button>
            </div>

            <div class="status-line" id="status">Listo.</div>

            <div class="divider"></div>

            <label for="last_jobs_select">Últimos jobs</label>
            <select id="last_jobs_select">
              <option value="">— Cargar jobs —</option>
            </select>

            <div id="job_progress" style="display:none;">
              <div class="badges">
                <span class="badge queued"><span class="mini-dot"></span>Queued: <strong id="stat_queued">0</strong></span>
                <span class="badge sent"><span class="mini-dot"></span>Sent: <strong id="stat_sent">0</strong></span>
                <span class="badge ok"><span class="mini-dot"></span>OK: <strong id="stat_ok">0</strong></span>
                <span class="badge err"><span class="mini-dot"></span>Error: <strong id="stat_error">0</strong></span>
              </div>
              <div class="progress"><div id="progress_fill"></div></div>
              <div class="progress-text" id="progress_text">—</div>
            </div>

            <p class="hint">Tip: configurá API, token y <b>X-Account</b> desde <i>Opciones</i> de la extensión.</p>
          </div>
        </div>

        <!-- TAB: ENVIAR -->
        <div id="tab-send" class="tab-content">
          <div class="section">
            <p class="section-title">Envío de mensajes</p>
            <p class="hint" style="margin-top:0;">
              Elegí un job (followings o análisis) y encolá el envío a pendientes.
            </p>

            <label for="send_recipients_job_select">Origen de destinatarios</label>
            <select id="send_recipients_job_select">
              <option value="">— Cargar jobs —</option>
            </select>
            <div id="send_recipients_info" style="margin-top: 8px; display: none;">
              <span class="hint" id="send_recipients_summary"></span>
            </div>

            <div class="check">
              <input type="checkbox" id="dry_run" checked />
              <div>
                <div style="font-weight:800; margin-bottom:2px;">Dry-run</div>
                <div style="color:var(--muted); font-size:11px;">Escribe pero no envía. Desmarcá para enviar realmente.</div>
              </div>
            </div>

            <div id="send_job_progress_section" style="display:none; margin-top: 10px;">
              <div class="badges">
                <span class="badge queued"><span class="mini-dot"></span>Queued: <strong id="send_stat_queued">0</strong></span>
                <span class="badge sent"><span class="mini-dot"></span>Sent: <strong id="send_stat_sent">0</strong></span>
                <span class="badge ok"><span class="mini-dot"></span>OK: <strong id="send_stat_ok">0</strong></span>
                <span class="badge err"><span class="mini-dot"></span>Error: <strong id="send_stat_error">0</strong></span>
              </div>
              <div class="progress"><div id="send_progress_fill"></div></div>
              <div class="progress-text" id="send_progress_text">—</div>
            </div>

            <label for="send_message">Mensaje</label>
            <textarea id="send_message" placeholder="Hola! Me gustaría contactarte..."></textarea>
            <div class="hint">Caracteres: <span id="message_char_count">0</span>/1000</div>

            <button id="enqueue_send" class="btn success" style="margin-top:10px;">Encolar envío a pendientes</button>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px;">
              <button id="start_sender" class="btn primary">Iniciar</button>
              <button id="stop_sender" class="btn danger" disabled>Detener</button>
            </div>

            <div class="status-line" id="send_status">Listo para configurar.</div>

            <div class="divider"></div>

            <div class="hint" style="display:flex; justify-content:space-between; gap:10px;">
              <span>Límite diario: <b id="limit_daily">—</b></span>
              <span>Por hora: <b id="limit_hourly">—</b></span>
            </div>
          </div>
        </div>

        </div>
      </div><!-- /main-ui -->

      <div class="footer-note" id="footer-note" style="cursor:pointer;" title="Abrir Opciones">
        Clic aquí para abrir <b>Opciones</b> y configurar API, token y cuenta.
      </div>
    </div>
  </div>

  <script src="popup.js"></script>
</body>
</html>
